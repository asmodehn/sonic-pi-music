# Bar and beats synchronization

use_bpm 120
beats = 4
sub_beat = 4

chords = [
  (chord :B, :minor),
  (chord :D, :major),
  (chord :G, :major),
  (chord :Fs, :dom7)
].ring

bar_chord = chords[0]


live_loop :bar_beats do
  cue :bar
  beats.times do
    cue :beat
    sleep 1
  end
  bar_chord = chords.tick
end


live_loop :keys do
  use_synth :blade
  sync :beat
  play bar_chord, release:0.8
end

live_loop :bass do
  use_synth :subpulse
  use_octave -2
  sync :beat
  play choose(bar_chord), release:0.2
  sleep 0.5
  play choose(bar_chord), release:0.2
end

live_loop :cymbals do
  sync :beat
  sample :drum_cymbal_closed, amp: 0.5
  (sub_beat - 1).times do
    sleep (1 / Float(sub_beat))
    sample :drum_cymbal_closed, amp: 0.25
  end
end

live_loop :drums do
  sync :bar
  sample :drum_bass_hard, amp: 0.5
  sleep 0.5
  sample :drum_bass_hard, amp: 0.25
  sleep 0.5
  sample :drum_snare_hard, amp: 0.5
  sleep 0.5
  sample :drum_bass_hard, amp: 0.25
  sleep 0.25
  sample :drum_snare_hard, amp: 0.25
  sleep 0.25
  sample :drum_bass_hard, amp: 0.25
  sleep 0.25
  sample :drum_snare_hard, amp: 0.25
  sleep 0.25
  sample :drum_bass_hard, amp: 0.25
  sleep 0.5
  sample :drum_snare_hard, amp: 0.25
  sleep 0.5
  sample :drum_bass_hard
  sleep 0.25
  sample :drum_snare_hard
  #  sleep 0.25
end