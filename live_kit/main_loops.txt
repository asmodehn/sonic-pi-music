# Bar and beats synchronization

use_bpm 120
beats = 2
sub_beat = 4
sub_beat_inv = 1 / Float(sub_beat)

chords = [
  (chord :C, :major),
  (chord :A, :minor),
  (chord :D, :minor),
  (chord :G, :dom7)
].ring

bar_chord = (chord :C, :major)


# ---- live loops

live_loop :bar_beats do
  bar_chord = chords.tick
  cue :bar
  beats.times do
    cue :beat
    sleep 1
  end
end

live_loop :keys do
  #sync :beat
  sync :bar
  play bar_chord, amp: 0.5, release: beats
end

live_loop :bass do
  sync :beat
  play choose(bar_chord), release:0.2
  #sync :bar
end

live_loop :cymbals do
  sync :beat
  sample :drum_cymbal_closed, amp: 0.25
  #sync :bar
end

live_loop :drums do
  sync :beat
  #sync :bar
end
